(self.webpackChunkWebComponents=self.webpackChunkWebComponents||[]).push([[106],{86151:()=>{$.i18n().load({en:{msg_no_answer:"No answer provided.",msg_fitb_check_me:"Check me",msg_fitb_compare_me:"Compare me"}})},61353:()=>{$.i18n().load({"pt-br":{msg_no_answer:"Nenhuma resposta dada.",msg_fitb_check_me:"Verificar",msg_fitb_compare_me:"Comparar"}})},23106:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var r=i(2568);i(86151),i(61353);class s extends r.Z{constructor(e){super(e);var t=e.orig;this.useRunestoneServices=e.useRunestoneServices,this.origElem=t,this.divid=t.id,this.correct=null,this.feedbackArray=JSON.parse(this.scriptSelector(this.origElem).html()),this.createFITBElement(),this.caption="Fill in the Blank",this.addCaption("runestone"),this.checkServer("fillb",!0),"undefined"!=typeof Prism&&Prism.highlightAllUnder(this.containerDiv)}scriptSelector(e){return $(e).find('script[type="application/json"]')}createFITBElement(){this.renderFITBInput(),this.renderFITBButtons(),this.renderFITBFeedbackDiv(),$(this.origElem).replaceWith(this.containerDiv)}renderFITBInput(){this.containerDiv=document.createElement("div"),this.containerDiv.id=this.divid,$(this.origElem).children().clone().appendTo(this.containerDiv),this.scriptSelector(this.containerDiv).remove();let e=$(this.containerDiv).find(":input");e.attr("class","form form-control selectwidthauto"),e.attr("aria-label","input area"),this.blankArray=e.toArray();for(let e of this.blankArray)$(e).change(this.recordAnswered.bind(this))}recordAnswered(){this.isAnswered=!0}renderFITBButtons(){this.submitButton=document.createElement("button"),this.submitButton.textContent=$.i18n("msg_fitb_check_me"),$(this.submitButton).attr({class:"btn btn-success",name:"do answer",type:"button"}),this.submitButton.addEventListener("click",function(){this.checkCurrentAnswer(),this.logCurrentAnswer()}.bind(this),!1),this.containerDiv.appendChild(document.createElement("br")),this.containerDiv.appendChild(document.createElement("br")),this.containerDiv.appendChild(this.submitButton),this.useRunestoneServices&&(this.compareButton=document.createElement("button"),$(this.compareButton).attr({class:"btn btn-default",id:this.origElem.id+"_bcomp",disabled:"",name:"compare"}),this.compareButton.textContent=$.i18n("msg_fitb_compare_me"),this.compareButton.addEventListener("click",function(){this.compareFITBAnswers()}.bind(this),!1),this.containerDiv.appendChild(this.compareButton)),this.containerDiv.appendChild(document.createElement("div"))}renderFITBFeedbackDiv(){this.feedBackDiv=document.createElement("div"),this.feedBackDiv.id=this.divid+"_feedback",this.containerDiv.appendChild(document.createElement("br")),this.containerDiv.appendChild(this.feedBackDiv)}restoreAnswers(e){var t;try{if(t=JSON.parse(e.answer),!Array.isArray(t))throw new Error}catch(i){t=e.answer.split(",")}for(var i=0;i<this.blankArray.length;i++)$(this.blankArray[i]).attr("value",t[i]);this.feedbackArray?this.checkCurrentAnswer():(this.displayFeed=e.displayFeed,this.correct=e.correct,this.isCorrectArray=e.isCorrectArray,void 0!==this.displayFeed&&void 0!==this.correct&&void 0!==this.isCorrectArray&&this.renderFeedback())}checkLocalStorage(){var e;if(!this.graderactive&&localStorage.length>0){var t=localStorage.getItem(this.localStorageKey());if(null!==t){try{(e=JSON.parse(t)).answer}catch(e){return console.log(e.message),void localStorage.removeItem(this.localStorageKey())}this.restoreAnswers(e)}}}setLocalStorage(e){let t=this.localStorageKey();localStorage.setItem(t,JSON.stringify(e))}checkCurrentAnswer(){this.isCorrectArray=[],this.displayFeed=[],this.given_arr=[];for(var e=0;e<this.blankArray.length;e++)this.given_arr.push(this.blankArray[e].value);this.useRunestoneServices&&eBookConfig.enableCompareMe&&this.enableCompareButton(),this.feedbackArray&&(this.evaluateAnswers(),this.isTimed||this.renderFeedback())}async logCurrentAnswer(e){let t=JSON.stringify(this.given_arr),i=!0;this.setLocalStorage({answer:t,timestamp:new Date});let r={event:"fillb",act:t||"",answer:t||"",correct:this.correct?"T":"F",div_id:this.divid};void 0!==e&&(r.sid=e,i=!1),r=await this.logBookEvent(r);let s=r&&r.detail;if(i)return this.feedbackArray||(this.setLocalStorage({answer:t,timestamp:s.timestamp}),this.correct=s.correct,this.displayFeed=s.displayFeed,this.isCorrectArray=s.isCorrectArray,this.isTimed||this.renderFeedback()),s}evaluateAnswers(){this.correct=!0;for(var e=0;e<this.blankArray.length;e++){var t=this.blankArray[e].value;if(""===t)this.isCorrectArray.push(null),this.displayFeed.push($.i18n("msg_no_answer")),this.correct=!1;else{for(var i=this.feedbackArray[e]||[],r=0;r<i.length;r++){if(r===i.length-1){this.displayFeed.push(i[r].feedback);break}if("regex"in i[r]){if(RegExp(i[r].regex,i[r].regexFlags).test(t)){this.displayFeed.push(i[r].feedback);break}}else{console.assert("number"in i[r]);var[s,a]=i[r].number,n=+t;if(n>=s&&n<=a){this.displayFeed.push(i[r].feedback);break}}}let o=0===r&&i.length>1;this.isCorrectArray.push(o),o||(this.correct=!1)}}this.percent=this.isCorrectArray.filter(Boolean).length/this.blankArray.length}renderFeedback(){if(this.correct){$(this.feedBackDiv).attr("class","alert alert-info");for(let e=0;e<this.blankArray.length;e++)$(this.blankArray[e]).removeClass("input-validation-error")}else{null===this.displayFeed&&(this.displayFeed="");for(let e=0;e<this.blankArray.length;e++)!0!==this.isCorrectArray[e]?$(this.blankArray[e]).addClass("input-validation-error"):$(this.blankArray[e]).removeClass("input-validation-error");$(this.feedBackDiv).attr("class","alert alert-danger")}for(var e="<ul>",t=0;t<this.displayFeed.length;t++)e+="<li>"+this.displayFeed[t]+"</li>";e+="</ul>",1==this.displayFeed.length&&(e=e.slice(8,-10)),this.feedBackDiv.innerHTML=e,"undefined"!=typeof MathJax&&this.queueMathJax(document.body)}enableCompareButton(){this.compareButton.disabled=!1}compareFITBAnswers(){var e={};e.div_id=this.divid,e.course=eBookConfig.course,jQuery.get(`${eBookConfig.new_server_prefix}/assessment/gettop10Answers`,e,this.compareFITB)}compareFITB(e,t,i){var r=e.detail.res,s=(e.detail.miscdata,"<table>");for(var a in s+="<tr><th>Answer</th><th>Count</th></tr>",r)s+="<tr><td>"+r[a].answer+"</td><td>"+r[a].count+" times</td></tr>";s+="</table>",$("<div class='modal fade'>    <div class='modal-dialog compare-modal'>        <div class='modal-content'>            <div class='modal-header'>                <button type='button' class='close' data-dismiss='modal' aria-hidden='true'>&times;</button>                <h4 class='modal-title'>Top Answers</h4>            </div>            <div class='modal-body'>"+s+"            </div>        </div>    </div></div>").modal()}disableInteraction(){for(var e=0;e<this.blankArray.length;e++)this.blankArray[e].disabled=!0}}$(document).on("runestone:login-complete",(function(){$("[data-component=fillintheblank]").each((function(e){var t={orig:this,useRunestoneServices:eBookConfig.useRunestoneServices};if(0==$(this).closest("[data-component=timedAssessment]").length)try{window.componentMap[this.id]=new s(t)}catch(e){console.log(`Error rendering Fill in the Blank Problem ${this.id}\n                     Details: ${e}`)}}))}));class a extends s{constructor(e){super(e),this.renderTimedIcon(this.inputDiv),this.hideButtons(),this.needsReinitialization=!0}hideButtons(){$(this.submitButton).hide(),$(this.compareButton).hide()}renderTimedIcon(e){var t=document.createElement("div"),i=document.createElement("img");$(i).attr({src:"../_static/clock.png",style:"width:15px;height:15px"}),t.className="timeTip",t.title="",t.appendChild(i),$(e).prepend(t)}checkCorrectTimed(){switch(this.correct){case!0:return"T";case!1:return"F";default:return null}}hideFeedback(){for(var e=0;e<this.blankArray.length;e++)$(this.blankArray[e]).removeClass("input-validation-error");this.feedBackDiv.style.display="none"}reinitializeListeners(){for(let e of this.blankArray)$(e).change(this.recordAnswered.bind(this))}}void 0===window.component_factory&&(window.component_factory={}),window.component_factory.fillintheblank=function(e){return e.timed?new a(e):new s(e)}}}]);
//# sourceMappingURL=prefix-106.d9424d1b9ef5ddef.bundle.js.map